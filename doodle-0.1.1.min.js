if(!Array.prototype.indexOf){Array.prototype.indexOf=function(b){var a=this.length>>>0;var c=Number(arguments[1])||0;c=(c<0)?Math.ceil(c):Math.floor(c);if(c<0){c+=a}for(;c<a;c++){if(c in this&&this[c]===b){return c}}return -1}}if(!Array.prototype.lastIndexOf){Array.prototype.lastIndexOf=function(b){var a=this.length;var c=Number(arguments[1]);if(isNaN(c)){c=a-1}else{c=(c<0)?Math.ceil(c):Math.floor(c);if(c<0){c+=a}else{if(c>=a){c=a-1}}}for(;c>-1;c--){if(c in this&&this[c]===b){return c}}return -1}}if(!Array.prototype.filter){Array.prototype.filter=function(b){var a=this.length;if(typeof b!="function"){throw new TypeError()}var e=new Array();var d=arguments[1];for(var c=0;c<a;c++){if(c in this){var f=this[c];if(b.call(d,f,c,this)){e.push(f)}}}return e}}if(!Array.prototype.forEach){Array.prototype.forEach=function(b){var a=this.length>>>0;if(typeof b!="function"){throw new TypeError()}var d=arguments[1];for(var c=0;c<a;c++){if(c in this){b.call(d,this[c],c,this)}}}}if(!Array.prototype.every){Array.prototype.every=function(b){var a=this.length>>>0;if(typeof b!="function"){throw new TypeError()}var d=arguments[1];for(var c=0;c<a;c++){if(c in this&&!b.call(d,this[c],c,this)){return false}}return true}}if(!Array.prototype.map){Array.prototype.map=function(b){var a=this.length>>>0;if(typeof b!="function"){throw new TypeError()}var e=new Array(a);var d=arguments[1];for(var c=0;c<a;c++){if(c in this){e[c]=b.call(d,this[c],c,this)}}return e}}if(!Array.prototype.some){Array.prototype.some=function(b){var a=this.length>>>0;if(typeof b!="function"){throw new TypeError()}var d=arguments[1];for(var c=0;c<a;c++){if(c in this&&b.call(d,this[c],c,this)){return true}}return false}}if(!Array.prototype.reduce){Array.prototype.reduce=function(b){var a=this.length>>>0;if(typeof b!="function"){throw new TypeError()}if(a==0&&arguments.length==1){throw new TypeError()}var c=0;if(arguments.length>=2){var d=arguments[1]}else{do{if(c in this){d=this[c++];break}if(++c>=a){throw new TypeError()}}while(true)}for(;c<a;c++){if(c in this){d=b.call(null,d,this[c],c,this)}}return d}}if(!Array.prototype.reduceRight){Array.prototype.reduceRight=function(b){var a=this.length>>>0;if(typeof b!="function"){throw new TypeError()}if(a==0&&arguments.length==1){throw new TypeError()}var c=a-1;if(arguments.length>=2){var d=arguments[1]}else{do{if(c in this){d=this[c--];break}if(--c<0){throw new TypeError()}}while(true)}for(;c>=0;c--){if(c in this){d=b.call(null,d,this[c],c,this)}}return d}}if(typeof Array.isArray!=="function"){Array.isArray=function(a){return Object.prototype.toString.call(a)==="[object Array]"}}if(typeof Array.arrayp!=="function"){Array.arrayp=Array.isArray}if(typeof Function.prototype.bind!=="function"){Function.prototype.bind=function(a){var b=this;return function(){return b.apply(a,arguments)}}}if(typeof Object.getPrototypeOf!=="function"){if(typeof"test".__proto__==="object"){Object.getPrototypeOf=function(a){return a.__proto__}}else{Object.getPrototypeOf=function(a){return a.constructor.prototype}}}var $doodle={};function throwError(a,b){throw new a(b)}$doodle.utils={};$doodle.utils.parse={};$doodle.utils.parse.relativeEquation=function(a,b){var c=parseFloat(b.substr(2));switch(b.substr(0,2)){case"+=":a+=c;break;case"-=":a-=c;break;case"*=":a*=c;break;case"/=":a/=c;break;case"%=":a%=c;break;default:a=b}return a};$doodle.utils.parse.rotation=function(c){var b=parseFloat(c);if(!c.match(/rad/i)){b=b*Math.PI/180}return b};$doodle.utils.draw={};$doodle.utils.draw.circle=function(b,a,c){b.fillStyle=c;b.beginPath();b.arc(0,0,a,0,Math.PI*2,true);b.closePath();b.fill()};$doodle.utils.draw.axis=function(a){var b;a.context.save();if(a.axis.coord==="local"){b="#FF0000";a.context.translate(a.axis.x,a.axis.y)}else{if(a.axis.coord==="global"){b="#009999";a.context.translate(a.axis.x-a.x,a.axis.y-a.y)}else{}}a.context.globalAlpha=1;$doodle.utils.draw.circle(a.context,3,"#000000");$doodle.utils.draw.circle(a.context,2,b);a.context.restore()};$doodle.animate=function(b,h,a){if(typeof b!=="function"){throw new TypeError("doodle.animate: Must execute a function.")}h=(typeof h!=="undefined")?h:42;if(typeof a==="undefined"){a=true}var g;var f;var c=$doodle.canvas().context;var d={};d.ing=true;d.play=function(i){if(arguments.length===0){return g}if(i===false){clearInterval(f)}else{if(i===true){setInterval(e,g)}else{if(typeof i==="string"){if(i.match(/fps/i)){i=(1000/parseInt(i,10))|0}else{if(i.match(/sec/i)){i=(1000*parseFloat(i))|0}}}g=i;clearInterval(f);f=setInterval(e,g)}}};d.play(h);function e(){if(a){c.save();$doodle.canvas().clear();c.restore()}b()}};$doodle.utils.time=function(a,c,b){if(typeof c==="undefined"){c=1000}if(typeof b==="undefined"){b=false}var d=0,f=(new Date);for(var e=0;e<c;e=e+1){a()}d=(new Date);d=d.getTime()-f.getTime();if(b){console.log("Elapsed time (total): "+d+" msecs")}else{console.log("Elapsed time (avg): "+(d/c)+" msecs")}return a()};if(!$doodle){var $doodle={}}if(!$doodle.Matrix){$doodle.Matrix={}}$doodle.Matrix.isMatrix=function(a){if(Array.isArray(a)&&a.length===6){var b=a.length;while(--b>-1){if(typeof a[b]!=="number"){return false}}return true}else{return false}};$doodle.matrixp=$doodle.Matrix.isMatrix;$doodle.Matrix.identity=function(){var a=new Array(6);a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;return a};$doodle.Matrix.nidentity=function(a){if($doodle.Matrix.isMatrix(a)){a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;return a}throw new TypeError("Matrix.nidentity: argument is not a matrix.")};$doodle.Matrix.create=function(j,h,l,k,i,g){var f=arguments.length,e;if(f===6){e=Array.prototype.slice.call(arguments);if($doodle.Matrix.isMatrix(e)){return e}}else{if(f===1){e=arguments[0].concat();if($doodle.Matrix.isMatrix(e)){return e}}}throw new SyntaxError("Matrix.create: A matrix requires 6 numbers.")};$doodle.Matrix.ncreate=function(b){if($doodle.Matrix.isMatrix(b)){return b}else{var a=Array.prototype.slice.call(arguments);$doodle.Matrix.create(a)}};$doodle.Matrix.add=function(c,b){var a=new Array(6);a[0]=c[0]+b[0];a[1]=c[1]+b[1];a[2]=c[2]+b[2];a[3]=c[3]+b[3];a[4]=c[4]+b[4];a[5]=c[5]+b[5];return a};$doodle.Matrix.nadd=function(b,a){b[0]=b[0]+a[0];b[1]=b[1]+a[1];b[2]=b[2]+a[2];b[3]=b[3]+a[3];b[4]=b[4]+a[4];b[5]=b[5]+a[5];return b};$doodle.Matrix.multiply=function(c,b){var a=new Array(6);a[0]=c[0]*b[0]+c[2]*b[1];a[1]=c[1]*b[0]+c[3]*b[1];a[2]=c[0]*b[2]+c[2]*b[3];a[3]=c[1]*b[2]+c[3]*b[3];a[4]=c[0]*b[4]+c[2]*b[5]+c[4];a[5]=c[1]*b[4]+c[3]*b[5]+c[5];return a};$doodle.Matrix.nmultiply=function(h,g){var f=h[0]*g[0]+h[2]*g[1],e=h[1]*g[0]+h[3]*g[1],j=h[0]*g[2]+h[2]*g[3],i=h[1]*g[2]+h[3]*g[3];h[4]=h[0]*g[4]+h[2]*g[5]+h[4];h[5]=h[1]*g[4]+h[3]*g[5]+h[5];h[0]=f;h[1]=e;h[2]=j;h[3]=i;return h};$doodle.Matrix.translate=function(c,b,a){return $doodle.Matrix.multiply(c,[1,0,0,1,b,a])};$doodle.Matrix.ntranslate=function(c,b,a){return $doodle.Matrix.nmultiply(c,[1,0,0,1,b,a])};$doodle.Matrix.rotate=function(b,d){var a=Math.sin(d),c=Math.cos(d);return $doodle.Matrix.multiply(b,[c,a,-a,c,0,0])};$doodle.Matrix.nrotate=function(b,d){var a=Math.sin(d),c=Math.cos(d);return $doodle.Matrix.nmultiply(b,[c,a,-a,c,0,0])};$doodle.Matrix.rotation=function(a){return Math.atan2(a[1],a[0])};$doodle.Matrix.scale=function(a,c,b){return $doodle.Matrix.multiply(a,[c,0,0,b,0,0])};$doodle.Matrix.nscale=function(a,c,b){return $doodle.Matrix.nmultiply(a,[c,0,0,b,0,0])};$doodle.Matrix.skew=function(b,e,d){var c=Math.tan(e),a=Math.tan(d);return $doodle.Matrix.multiply(b,[1,a,c,1,0,0])};$doodle.Matrix.nskew=function(b,e,d){var c=Math.tan(e),a=Math.tan(d);return $doodle.Matrix.nmultiply(b,[1,a,c,1,0,0])};$doodle.Matrix.invert=function(b){var a=new Array(6),c=b[0]*b[3]-b[1]*b[2];a[0]=b[3]/c;a[1]=-b[1]/c;a[2]=-b[2]/c;a[3]=b[0]/c;a[4]=(b[5]*b[2]-b[3]*b[4])/c;a[5]=-(b[5]*b[0]-b[1]*b[4])/c;return a};$doodle.Matrix.transformPoint=function(a,b){return{x:b.x*a[0]+b.y*a[1]+a[4],y:b.x*a[2]+b.y*a[3]+a[5]}};$doodle.Matrix.ntransformPoint=function(b,c){var a=c.x*b[0]+c.y*b[1]+b[4],d=c.x*b[2]+c.y*b[3]+b[5];c.x=a;c.y=d;return c};$doodle.Matrix.deltaTransformPoint=function(a,b){return{x:b.x*a[0]+b.y*a[1],y:b.x*a[2]+b.y*a[3]}};$doodle.Matrix.ndeltaTransformPoint=function(b,c){var a=c.x*b[0]+c.y*b[1],d=c.x*b[2]+c.y*b[3];c.x=a;c.y=d;return c};$doodle.Matrix.rotateAroundExternalPoint=function(c,b,e,d){var a=$doodle.Matrix.translate(c,b,e);$doodle.Matrix.nrotate(a,d*Math.PI/180);a[4]-=b;a[5]-=e;return a};$doodle.Matrix.nrotateAroundExternalPoint=function(b,a,d,c){b[4]+=a;b[5]+=d;$doodle.Matrix.nrotate(b,c*Math.PI/180);b[4]-=a;b[5]-=d;return b};$doodle.Matrix.rotateAroundInternalPoint=function(c,b,f,e){var d=$doodle.Matrix.transformPoint(c,{x:b,y:f}),a=$doodle.Matrix.rotateAroundExternalPoint(c,d.x,d.y,e);return a};$doodle.Matrix.nrotateAroundInternalPoint=function(b,a,e,d){var c=$doodle.Matrix.transformPoint(b,{x:a,y:e});$doodle.Matrix.nrotateAroundExternalPoint(b,c.x,c.y,d);return b};$doodle.Matrix.matchInternalPointWithExternal=function(f,c,g){var e=$doodle.Matrix.transformPoint(f,c),d=g.x-e.x,b=g.y-e.y,a=$doodle.Matrix.translate(f,d,b);return a};$doodle.Matrix.nmatchInternalPointWithExternal=function(e,b,f){var d=$doodle.Matrix.transformPoint(e,b),c=f.x-d.x,a=f.y-d.y;e[4]+=c;e[5]+=a;return e};$doodle.canvas=function(){var d;var c=false;var b=false;var e=function(f){if(arguments.length===0){return d}if(typeof f==="string"&&f[0]==="#"){f=f.slice(1)}d=document.getElementById(f)||f;if(d.getContext){d.context=d.getContext("2d");a();return d}else{console.log("$doodle: canvas not supported.")}};function a(){d.bgcolor=function(f){if(arguments.length===0){return c}c=f;d.context.fillStyle=c;d.context.fillRect(0,0,d.width,d.height);return d};d.bgimage=function(f){if(arguments.length===0){return b}if(typeof f==="string"){b=new Image();b.src=f}else{b=f}b.onload=function(){d.context.drawImage(b,0,0)};return d};d.clear=function(){d.context.save();d.context.clearRect(0,0,d.width,d.height);if(c){d.context.fillStyle=c;d.context.fillRect(0,0,d.width,d.height)}if(b){d.context.drawImage(b,0,0)}d.context.restore()}}return e}();$doodle.point=function(b){var a={};if(arguments.length===2||arguments.length===0){a.x=(typeof(arguments[0])==="number")?arguments[0]:undefined;a.y=(typeof(arguments[1])==="number")?arguments[1]:undefined}else{if(arguments.length===3){a.x=(typeof(arguments[0])==="number")?arguments[0]:undefined;a.y=(typeof(arguments[1])==="number")?arguments[1]:undefined;if((typeof arguments[2]==="string")&&(arguments[2]==="local"||arguments[2]==="global")){a.coord=arguments[2]}else{throw new SyntaxError("point: Axis-point must be 'local' or 'global'.")}}else{if(typeof(b)==="object"){a.x=(typeof(b[0])==="number")?b[0]:b.x;a.y=(typeof(b[1])==="number")?b[1]:b.y;if(b.coord){a.coord=b.coord}}}}return a};$doodle.object=function(e){var a={};for(var g in e){if(typeof e[g]==="function"){var c=e[g];a[g]=c(a)}else{a[g]=e[g]}}a.context=a.context||$doodle.canvas().context;a.visible=(typeof a.visible!=="undefined")?a.visible:true;a.x=(typeof a.x!=="undefined")?a.x:0;a.y=(typeof a.y!=="undefined")?a.y:0;a.z=(typeof a.z!=="undefined")?a.z:0;a.axis=a.axis||{};a.axis.x=(typeof a.axis.x!=="undefined")?a.axis.x:0;a.axis.y=(typeof a.axis.y!=="undefined")?a.axis.y:0;a.axis.coord=a.axis.coord||"local";a.axis.visible=(typeof a.axis.visible!=="undefined")?a.axis.visible:false;a.masks=a.masks||[];a.matrix=$doodle.Matrix.translate($doodle.Matrix.identity(),a.x,a.y);if(typeof a.z!=="number"){throw new TypeError("object: z must be a number.")}if(typeof a.visible!=="boolean"){throw new TypeError("object: visible must be true or false.")}if(a.axis&&(typeof a.axis.x!=="number"||typeof a.axis.y!=="number")){throw new TypeError("object: axis x and y must be numbers.")}if(a.axis.coord&&typeof a.axis.coord==="string"){if(a.axis.coord!=="local"&&a.axis.coord!=="global"){throw new SyntaxError("object: axis coord must be 'local' or 'global'.")}}if(typeof a.axis.visible!=="boolean"){throw new TypeError("object: axis.visible must be 'true' or 'false'.")}if(typeof a.masks==="object"&&typeof a.masks.length==="number"){for(var b=0;b<a.masks.length;b++){if(typeof a.masks[b]!=="function"){throw new TypeError("object.masks: '"+a.masks[b]+"' must be a shape function.")}}}else{throw new TypeError("object.masks: Must be an Array of shape functions.")}a.loaded=true;a.modify=function(k){var i,m;var h={};for(var l in k){if(typeof k[l]==="function"){i=k[l];k[l]=i(a,a[l])}switch(l){case"x":m=k[l];if(typeof m==="string"){m=$doodle.utils.parse.relativeEquation(a[l],m)}a.translate(m-a.x,0);a[l]=m;break;case"y":m=k[l];if(typeof m==="string"){m=$doodle.utils.parse.relativeEquation(a[l],m)}a.translate(0,m-a.y);a[l]=m;break;case"z":m=k[l];if(typeof m==="string"){m=$doodle.utils.parse.relativeEquation(a[l],m)}a[l]=m;break;case"alpha":m=k[l];if(typeof m==="string"){m=$doodle.utils.parse.relativeEquation(a[l],m)}if(m>1){m=1}if(m<0){m=0}a[l]=m;break;case"width":m=k[l];if(typeof m==="string"){m=$doodle.utils.parse.relativeEquation(a[l],m)}a[l]=m;break;case"height":m=k[l];if(typeof m==="string"){m=$doodle.utils.parse.relativeEquation(a[l],m)}a[l]=m;break;case"fill":a[l]=k[l];break;case"axis":for(var j in k[l]){switch(j){case"x":case"y":if(typeof k[l][j]==="string"){k[l][j]=$doodle.utils.parse.relativeEquation(a.axis[j],k[l][j])}a[l][j]=k[l][j];break;case"coord":case"visible":a[l][j]=k[l][j];break;default:throw new SyntaxError("object.modify.axis: "+j+" parameter not found.")}}break;case"translate":i=a[l];i(k[l]);break;case"rotate":i=a[l];i(k[l]);break;case"scale":i=a[l];i(k[l]);break;case"transform":i=a[l];i(k[l]);break;default:m=k[l];if(typeof m==="string"){m=$doodle.utils.parse.relativeEquation(a[l],m)}a[l]=m}}return a};a.translate=function(h){var f,i;if(arguments.length===2){f=arguments[0];i=arguments[1]}else{if(typeof h==="object"){f=h[0]||h.x;i=h[1]||h.y}else{throw new SyntaxError("translate: requires a point.")}}a.matrix=$doodle.Matrix.translate(a.matrix,f,i);a.x=a.matrix[4];a.y=a.matrix[5];return a};a.rotate=function(k,j){var i,h;if(typeof j==="undefined"){j=a.axis}if(j.coord==="local"){i=j.x;h=j.y}else{if(j.coord==="global"){i=j.x-a.x;h=j.y-a.y}else{throw new SyntaxError("rotate: coord system must be 'local' or 'global'.")}}var f=$doodle.Matrix.translate(a.matrix,i,h);f=$doodle.Matrix.rotate(f,k*Math.PI/180);a.matrix=$doodle.Matrix.translate(f,-i,-h);return a};a.scale=function(h){var i,f;if(typeof h==="object"){if(h.length===1){i=f=h[0]}else{i=h[0]||h.x;f=h[1]||h.y}}else{if(arguments.length===1){i=f=h}else{if(arguments.length===2){i=arguments[0];f=arguments[1]}}}a.matrix=$doodle.Matrix.scale(a.matrix,i,f);return a};a.transform=function(h){var f;if(arguments.length===1){f=$doodle.Matrix.create(h)}else{if(arguments.length===6){f=$doodle.Matrix.create(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])}else{throw new SyntaxError("object.transform: incorrect number or arguments.")}}a.matrix=$doodle.Matrix.multiply(a.matrix,f);return a};for(var d in e){if(d==="translate"){a.translate(e[d])}else{if(d==="rotate"){a.rotate(e[d])}else{if(d==="scale"){a.scale(e[d])}else{if(d==="transform"){a.transform(e[d])}}}}}return a};$doodle.sprite=function(f){if(typeof f.shape==="function"){var d=f.shape;delete f.shape}var m=$doodle.object(f);m.fill=(typeof m.fill!=="undefined")?m.fill:"#000000";m.alpha=(typeof m.alpha!=="undefined")?m.alpha:1;if(typeof m.fill==="string"&&m.fill[3]==="a"){var c=parseInt(m.fill.match(/\d*\s*(?=,)/),10);var h=parseInt(m.fill.match(/\d*\s*,\s*\d*\s*,\s*\d*\.?\d*\s*\)$/),10);var i=parseInt(m.fill.match(/\d*\s*,\s*\d*\.?\d*\s*\)$/),10);var k=parseFloat(m.fill.match(/\d*\.?\d*\s*\)$/),10);m.fill="rgb("+c+","+h+","+i+")";m.alpha=k;if(typeof c!=="number"||typeof h!=="number"||typeof i!=="number"||typeof k!=="number"){throw new TypeError("sprite: error parsing "+m.fill)}}if(typeof m.alpha!=="number"||(m.alpha<0||m.alpha>1)){throw new SyntaxError("sprite: alpha value must be between 0.0 and 1.0.")}function l(a){a.masks.map(function(b){a.context.beginPath();b();a.context.clip()})}m.animate=function(b,a){if(typeof a==="undefined"){a=42}m.loop(b,0,a,true)};m.loop=function(n,s,t,q){if(typeof s==="undefined"||typeof s!=="number"){throw new SyntaxError("sprite.loop: count must be a number.")}if(typeof q==="undefined"){q=false}var p=false;var o=1;var g;if(s===0){s=2;p=true}if(typeof t==="undefined"){t=false}else{if(typeof t==="string"){if(t.match(/fps/i)){t=(1000/parseInt(t,10))|0}else{if(t.match(/sec/i)){t=(1000*parseFloat(t,10))|0}}}}m.draw();if(t){g=setInterval(a,t);m.loop.ing=true}else{while(o<s){if(q){$doodle.canvas().clear()}if(typeof n==="object"){var u={};for(var b in n){if(b==="on_update"){var r=n[b]}else{u[b]=n[b]}}}if(typeof n==="function"){n(m);m.draw()}else{m.modify(u).draw()}if(typeof r!=="undefined"){r(m)}if(!p){o+=1}}}function a(){if(o<s){if(q){m.context.save();$doodle.canvas().clear();m.context.restore()}if(typeof n==="object"){var v={};for(var x in n){if(x==="on_update"){var w=n[x]}else{v[x]=n[x]}}}if(typeof n==="function"){n(m);m.draw()}else{m.modify(v).draw()}if(typeof w!=="undefined"){w(m)}if(!p){o+=1}}else{clearInterval(g);m.loop.ing=false}}return m};m.loop.ing=false;m.mold=undefined;m.shape=function(a){m.mold=a;return m};if(d){m.shape(d)}m.draw=function(a){a=a||m.mold;if(typeof(a)!=="function"){throw new Error("sprite.draw: no shape function provided.")}if(typeof(m.context)==="undefined"){throw new Error("sprite.draw: context must be defined.")}if(m.loaded){j(a)}else{e(m)}return m};function j(a){m.context.save();m.context.transform(m.matrix[0],m.matrix[1],m.matrix[2],m.matrix[3],m.matrix[4],m.matrix[5]);m.context.fillStyle=m.fill;if(m.alpha>1){m.context.globalAlpha=m.alpha}$doodle.gfx=m.context;if(m.masks.length){l(m)}if(m.visible){a(m)}if(m.axis.visible){$doodle.utils.draw.axis(m)}$doodle.gfx=$doodle.canvas().context;m.context.restore()}function e(n){if(!n.loading){var b=10000;var g=0;var a=setInterval(o,100);n.loading=true}function o(){if(m.loaded){clearInterval(a);m.draw()}else{if(g<b){g+=100}else{clearInterval(a);delete n.loading;throw new Error("group.redraw_when_loaded: Image load timeout.")}}}}return m};$doodle.group=function(d){var f,e,g;if(d&&typeof d.axis.x==="number"){f=d.axis.x}if(d&&typeof d.axis.y==="number"){e=d.axis.y}if(d&&typeof d.axis.coord==="string"){g=d.axis.coord}var i=$doodle.object(d);i.composite=i.composite||"source-over";i.axis.x=(typeof f!=="undefined")?f:$doodle.canvas().width/2;i.axis.y=(typeof e!=="undefined")?e:$doodle.canvas().height/2;i.axis.coord=(typeof g!=="undefined")?g:"global";var b=[];function h(j){j.masks.map(function(k){j.context.beginPath();k();j.context.clip()})}function a(j){j.context.save();j.context.translate(j.axis.x,j.axis.y);j.context.globalAlpha=1;j.context.fillStyle="#000000";j.context.beginPath();j.context.arc(0,0,4,0,Math.PI*2,true);j.context.closePath();j.context.fill();j.context.fillStyle="#00FF00";j.context.beginPath();j.context.arc(0,0,3,0,Math.PI*2,true);j.context.closePath();j.context.fill();j.context.restore()}i.add=function(k){for(var j=0;j<arguments.length;j++){b.push(arguments[j])}b.sort(function(m,l){return m.z-l.z});return i};i.remove=function(){for(var j=0;j<arguments.length;j++){b.splice(b.indexOf(arguments[j]),1)}return i};i.rotate=function(j){b.map(function(k){k.rotate(j,i.axis)});return i};i.draw=function(){if(typeof(i.context)==="undefined"){throw new Error("group.draw: context must be defined.")}i.context.save();i.context.globalCompositeOperation=i.composite;b.map(function(j){if(j.loaded){j.context=i.context;j.transform(i.matrix);j.draw()}else{c(j)}});if(i.axis.visible){a(i)}i.context.restore();return i};function c(m){if(!m.loading){var k=10000;var l=0;var j=setInterval(n,100);m.loading=true}function n(){if(m.loaded){i.draw();clearInterval(j);delete m.loading}else{if(l<k){l+=100}else{clearInterval(j);delete m.loading;throw new Error("group.redraw_when_loaded: Image load timeout.")}}}}i.loop=function(p,o,n,j){if(typeof o==="undefined"||typeof o!=="number"){throw new SyntaxError("sprite.loop: count must be a number.")}if(typeof j==="undefined"){j=false}var m=false;var k=1;var l;if(o===0){o=2;m=true}if(typeof n==="undefined"){n=false}else{if(typeof n==="string"){if(n.match(/fps/i)){n=(1000/parseInt(n,10))|0}else{if(n.match(/sec/i)){n=(1000*parseFloat(n,10))|0}}}}i.draw();if(n){l=setInterval(q,n);i.loop.ing=true}else{while(k<o){i.modify(p).draw();if(!m){k+=1}}}function q(){if(k<o){if(!m){k+=1}if(j){i.context.save();$doodle.canvas().clear();i.context.restore()}if(typeof p==="function"){p(i);i.draw()}else{i.modify(p).draw()}}else{clearInterval(l);i.loop.ing=false}}return i};return i};$doodle.rect=function(b){if(typeof b.width!=="number"||typeof b.height!=="number"){throw new SyntaxError("rect: requires width and height parameters.")}var a=$doodle.sprite(b);a.mold=function(){a.context.fillStyle=a.fill;a.context.fillRect(0,0,a.width,a.height)};return a};$doodle.circle=function(e){if(typeof e.radius==="undefined"){throw new SyntaxError("circle: requires radius parameter.")}var b=$doodle.sprite(e);var c=0;var a=Math.PI*2;var d=true;b.mold=function(){b.context.fillStyle=b.fill;b.context.beginPath();b.context.arc(0,0,b.radius,c,a,d);b.context.closePath();b.context.fill()};return b};$doodle.image=function(f){if(typeof f.on_load!=="undefined"){var d=f.on_load;delete f.on_load}var c=$doodle.sprite(f);var e;if(typeof c.width==="undefined"){c.width=f.width}if(typeof c.height==="undefined"){c.height=f.height}if(typeof c.src==="undefined"){e=new Image()}else{if(typeof c.src==="string"){e=new Image();e.src=c.src}else{if(typeof c.src==="object"){e=c.src}}}function g(){if(e.complete){b(e);clearInterval(a);c.loaded=true}}function b(h){c.width=h.width;c.height=h.height;if(typeof d==="function"){d(c)}}c.loaded=e.complete?true:false;if(c.loaded){b(e)}else{var a=setInterval(g,100)}c.mold=function(){c.context.drawImage(e,0,0,c.width,c.height)};return c};